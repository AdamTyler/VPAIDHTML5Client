{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","js/IVPAIDAdUnit.js","js/VPAIDAdUnit.js","js/VPAIDHTML5Client.js","js/utils.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VPAIDHTML5Client.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nvar noop = require('./utils').noop;\n\nvar METHODS = [\n    'handshakeVersion',\n    'initAd',\n    'startAd',\n    'stopAd',\n    'skipAd',\n    'resizeAd',\n    'pauseAd',\n    'resumeAd',\n    'expandAd',\n    'collapseAd',\n    'subscribe',\n    'unsubscribe'\n];\n\nvar EVENTS = [\n    'AdLoaded',\n    'AdStarted',\n    'AdStopped',\n    'AdSkipped',\n    'AdSkippableStateChange',\n    'AdSizeChange',\n    'AdLinearChange',\n    'AdDurationChange',\n    'AdExpandedChange',\n    'AdRemainingTimeChange', // [Deprecated in 2.0] but will be still fired for backwards compatibility\n    'AdVolumeChange',\n    'AdImpression',\n    'AdVideoStart',\n    'AdVideoFirstQuartile',\n    'AdVideoMidpoint',\n    'AdVideoThirdQuartile',\n    'AdVideoComplete',\n    'AdClickThru',\n    'AdInteraction',\n    'AdUserAcceptInvitation',\n    'AdUserMinimize',\n    'AdUserClose',\n    'AdPaused',\n    'AdPlaying',\n    'AdLog',\n    'AdError'\n];\n\nvar GETTERS = [\n    'getAdLinear',\n    'getAdWidth',\n    'getAdHeight',\n    'getAdExpanded',\n    'getAdSkippableState',\n    'getAdRemainingTime',\n    'getAdDuration',\n    'getAdVolume',\n    'getAdCompanions',\n    'getAdIcons'\n];\n\nvar SETTERS = [\n    'setAdVolume'\n];\n\n\nfunction IVPAIDAdUnit() {}\n\n//methods\nIVPAIDAdUnit.prototype.handshakeVersion = function (VPAIDVersion, callback) {};\nIVPAIDAdUnit.prototype.initAd = function(width, height, viewMode, desiredBitrate, creativeData, environmentVars, callback) {};\nIVPAIDAdUnit.prototype.startAd = function(callback) {};\nIVPAIDAdUnit.prototype.stopAd = function(callback) {};\nIVPAIDAdUnit.prototype.skipAd = function(callback) {};\nIVPAIDAdUnit.prototype.resizeAd = function(callback) {};\nIVPAIDAdUnit.prototype.pauseAd = function(callback) {};\nIVPAIDAdUnit.prototype.resumeAd = function(callback) {};\nIVPAIDAdUnit.prototype.expandAd = function(callback) {};\nIVPAIDAdUnit.prototype.collapseAd = function(callback) {};\nIVPAIDAdUnit.prototype.subscribe = function(event, handler, context) {};\nIVPAIDAdUnit.prototype.unsubscribe = function(event, handler) {};\n\n//getters\nIVPAIDAdUnit.prototype.getAdLinear = function(callback) {};\nIVPAIDAdUnit.prototype.getAdWidth = function(callback) {};\nIVPAIDAdUnit.prototype.getAdHeight = function(callback) {};\nIVPAIDAdUnit.prototype.getAdExpanded = function(callback) {};\nIVPAIDAdUnit.prototype.getAdSkippableState = function(callback) {};\nIVPAIDAdUnit.prototype.getAdRemainingTime = function(callback) {};\nIVPAIDAdUnit.prototype.getAdDuration = function(callback) {};\nIVPAIDAdUnit.prototype.getAdVolume = function(callback) {};\nIVPAIDAdUnit.prototype.getAdCompanions = function(callback) {};\nIVPAIDAdUnit.prototype.getAdIcons = function(callback) {};\n\n//setters\nIVPAIDAdUnit.prototype.setAdVolume = function(volume, callback) {}\n\naddStaticToInterface(IVPAIDAdUnit, 'METHODS', METHODS);\naddStaticToInterface(IVPAIDAdUnit, 'GETTERS', GETTERS);\naddStaticToInterface(IVPAIDAdUnit, 'SETTERS', SETTERS);\n\naddStaticToInterface(IVPAIDAdUnit, 'checkVPAIDInterface', function checkVPAIDInterface (creative) {\n    var result = METHODS.every(function(key) {\n        return typeof creative[key] === 'function';\n    });\n    return result;\n})\n\nmodule.exports = IVPAIDAdUnit;\n\nfunction addStaticToInterface(Interface, name, value) {\n    Object.defineProperty(Interface, name, {\n        writable: false,\n        configurable: false,\n        value: value\n    });\n}\n\n","'use strict';\n\nvar IVPAIDAdUnit = require('./IVPAIDAdUnit');\nvar checkVPAIDInterface = IVPAIDAdUnit.checkVPAIDInterface;\nvar METHODS = IVPAIDAdUnit.METHODS;\n\nfunction VPAIDAdUnit(VPAIDCreative) {\n    this._isValid = checkVPAIDInterface(VPAIDCreative);\n    if (this._isValid) {\n        this._creative = VPAIDCreative;\n    }\n}\n\nVPAIDAdUnit.prototype = Object.create(IVPAIDAdUnit.prototype);\n\nVPAIDAdUnit.prototype.isValidVPAIDAd = function isValidVPAIDAd() {\n    return this._isValid;\n}\n\nIVPAIDAdUnit.METHODS.forEach(function(method) {\n    VPAIDAdUnit.prototype[method] = function () {\n        var ariaty = IVPAIDAdUnit.prototype[method].length;\n        setTimeout(function () {\n            // TODO avoid leaking arguments\n            // https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#32-leaking-arguments\n            var args = Array.prototype.slice.call(arguments);\n            var callback = (ariaty === args.length) ? args.pop() : undefined;\n\n            var result, error;\n            try {\n                this._creative[method].apply(this._creative, args);\n            } catch(e) {\n                error = e;\n            }\n\n            callOrTriggerEvent(callback, error, result);\n        }, 0);\n    };\n});\n\n//alias\nVPAIDAdUnit.prototype.on = VPAIDAdUnit.prototype.subscribe;\nVPAIDAdUnit.prototype.off = VPAIDAdUnit.prototype.unsubscribe;\n\nIVPAIDAdUnit.GETTERS.forEach(function(getter) {\n    VPAIDAdUnit.prototype[getter] = function (callback) {\n        setTimeout(function () {\n\n            var result, error;\n            try {\n                result = this._creative[getter]();\n            } catch(e) {\n                error = e;\n            }\n\n            callOrTriggerEvent(callback, error, result);\n        }, 0);\n    };\n});\n\n//setters\nIVPAIDAdUnit.prototype.setAdVolume = function setAdVolume(volume) {\n    setTimeout(function () {\n\n        var result, error;\n        try {\n            this._creative.setAdVolume(volume);\n            result = this._creative.getAdVolume();\n        } catch(e) {\n            error = e;\n        }\n\n        error = utils.validate(!error && result !== volume, {msg: 'failed to apply volume: ' + volume});\n        callOrTriggerEvent(callback, error, result);\n    }, 0);\n};\n\n\nfunction callOrTriggerEvent(callback, error, result) {\n    if (callback) {\n        callback(error, result);\n    } else if (error) {\n        //todo use error subscribe\n    }\n}\n\nmodule.exports = VPAIDAdUnit;\n\n","'use strict';\n\n\nvar utils = require('./utils');\nvar unique = utils.unique('vpaidIframe');\nvar VPAIDAdUnit = require('./VPAIDAdUnit');\nvar defaultTemplate = \"<!DOCTYPE html>\\n<html lang=\\\"en\\\">\\n<head>\\n    <meta charset=\\\"UTF-8\\\">\\n</head>\\n<body>\\n    <script type=\\\"text/javascript\\\" src={{iframeURL_JS}}></script>\\n    <script>\\n        window.postMessage('{\\\"event\\\": \\\"ready\\\", \\\"id\\\": {{iframeID}}}', window.location.origin);\\n    </script>\\n</body>\\n</html>\\n\";\n\nfunction VPAIDHTML5Client(el, video, templateConfig, vpaidOptions) {\n    templateConfig = templateConfig || {};\n\n    this._id = unique();\n    this._destroyed = false;\n\n    this._el = utils.createElementInEl(el, 'div', this._id);\n    this._frameContainer = utils.createElementInEl(this._el, 'div');\n    this._adElContainer = utils.createElementInEl(this._el, 'div');\n    this._videoEl = video;\n    this._vpaidOptions = vpaidOptions || {timeout: 1000};\n\n    this._templateConfig = {\n        template: templateConfig.template || defaultTemplate,\n        extraOptions: templateConfig.extraOptions || {}\n    };\n\n}\n\nVPAIDHTML5Client.prototype.destroy = function destroy() {\n    this._destroyed = true;\n    this.unloadAdUnit();\n}\n\nVPAIDHTML5Client.prototype.isDestroyed = function isDestroyed() {\n    return this._destroyed;\n}\n\nVPAIDHTML5Client.prototype.loadAdUnit = function loadAdUnit(adURL, callback) {\n    $throwIfDestroyed.call(this);\n\n    this._frame = utils.createIframeWithContent(\n        this._frameContainer,\n        this._templateConfig.template,\n        utils.extend({\n            iframeURL_JS: adURL,\n            iframeID: this.getID()\n        }, this._templateConfig.extraOptions)\n    );\n\n    //TODO maybe rethink the timeout if is too hidden logic\n    this._onLoad = utils.callbackTimeout(\n        this._vpaidOptions.timeout,\n        onLoad.bind(this),\n        onTimeout.bind(this)\n    );\n\n    window.addEventListener('message', this._onLoad);\n\n    function onLoad (e) {\n        //don't clear timeout\n        if (e.origin !== window.location.origin) return;\n\n        var result = JSON.parse(e.data);\n\n        //don't clear timeout\n        if (result.id !== this.getID()) return;\n\n        var adUnit, error;\n        if (!this._frame.contentWindow) {\n\n            error = 'the iframe is not anymore in the DOM tree';\n\n        } else {\n            var createAd = this._frame.contentWindow.getVPAIDAd;\n            error = utils.validate(typeof createAd !== 'function', 'the ad didn\\'t return a function to create an ad');\n        }\n\n        if (!error) {\n            adUnit = new VPAIDAdUnit(createAd());\n            error = utils.validate(!adUnit.isValidVPAIDAd(), 'the add is not fully complaint with VPAID specification');\n        }\n\n        this._adUnit = adUnit;\n        $destroyLoadListener.call(this);\n        callback(error, error ? null : adUnit);\n\n        //clear timeout\n        return true;\n    }\n\n    function onTimeout() {\n        callback('timeout', null);\n    }\n}\n\nVPAIDHTML5Client.prototype.unloadAdUnit = function unloadAdUnit() {\n    $destroyLoadListener.call(this);\n\n    $removeEl.call(this, '_frame');\n    $removeEl.call(this, '_adEl');\n\n    if (this._adUnit) {\n        this._adUnit.stopAd();\n        delete this._adUnit;\n    }\n\n}\n\nVPAIDHTML5Client.prototype.getID = function () {\n    return this._id;\n}\n\nfunction $removeEl(key, parent) {\n    if (this[key]) {\n        this[key].parentElement.remove(this[key]);\n        delete this[key];\n    }\n}\n\nfunction $removeEl(key, parent) {\n    if (this[key]) {\n        this[key].parentElement.remove(this[key]);\n        delete this[key];\n    }\n}\n\nfunction $destroyLoadListener() {\n    if (this._onLoad) {\n        window.removeEventListener('load', this._onLoad);\n        utils.clearCallbackTimeout(this._onLoad);\n        delete this._onLoad;\n    }\n}\n\nfunction $throwIfDestroyed() {\n    if (this._destroyed) {\n        throw new Error ('VPAIDHTML5Client already destroyed!');\n    }\n}\n\nmodule.exports = VPAIDHTML5Client;\nwindow.VPAIDHTML5Client = VPAIDHTML5Client;\n\n","'use strict';\n\nfunction noop() {};\n\nfunction validate(isValid, message) {\n    return isValid ? message : null;\n}\n\nvar timeouts = {};\nfunction clearCallbackTimeout(func) {\n    var timeout = timeouts[func];\n    if (timeout) {\n        clearTimeout(timeout);\n        delete timeouts[func];\n    }\n}\n\nfunction callbackTimeout(timer, onSuccess, onTimeout) {\n    var callback, timeout;\n\n    timeout = setTimeout(function () {\n        onSuccess = noop;\n        delete timeout[callback]\n        onTimeout();\n    }, timer);\n\n    callback = function () {\n        // TODO avoid leaking arguments\n        // https://github.com/petkaantonov/bluebird/wiki/Optimization-killers#32-leaking-arguments\n        if (onSuccess.apply(this, arguments)) {\n            clearCallbackTimeout(callback);\n        }\n    };\n\n    timeouts[callback] = timeout;\n\n    return callback;\n}\n\nfunction createElementInEl(parent, tagName, id) {\n    var nEl = document.createElement(tagName);\n    if (id) nEl.id = id;\n    parent.appendChild(nEl);\n    return nEl;\n};\n\nfunction createIframeWithContent(parent, template, data) {\n    var iframe = createIframe(parent);\n    if (!setIframeContent(iframe, simpleTemplate(template, data))) return;\n    return iframe;\n}\n\nfunction createIframe(parent, url) {\n    var nEl = document.createElement('iframe');\n    nEl.src = url || 'about:blank';\n    nEl.width = 0;\n    nEl.height = 0;\n    parent.innerHTML = '';\n    parent.appendChild(nEl);\n    return nEl;\n};\n\nfunction simpleTemplate(template, data) {\n    Object.keys(data).forEach(function (key) {\n        template = template.replace(new RegExp('{{' + key + '}}', 'g'), JSON.stringify(data[key]));\n    });\n    return template;\n};\n\nfunction setIframeContent(iframeEl, content) {\n    var iframeDoc = iframeEl.contentWindow && iframeEl.contentWindow.document;\n    if (!iframeDoc) return false;\n\n    iframeDoc.write(content);\n\n    return true;\n};\n\nfunction extend(toExtend, fromSource) {\n    Object.keys(fromSource).forEach(function(key) {\n        toExtend[key] = fromSource[key];\n    });\n    return toExtend;\n};\n\n\nfunction unique(prefix) {\n    var count = -1;\n    return function () {\n        return prefix + '_' + (++count);\n    };\n};\n\nmodule.exports = {\n    noop: noop,\n    validate: validate,\n    clearCallbackTimeout: clearCallbackTimeout,\n    callbackTimeout: callbackTimeout,\n    createElementInEl: createElementInEl,\n    createIframeWithContent: createIframeWithContent,\n    createIframe: createIframe,\n    simpleTemplate: simpleTemplate,\n    setIframeContent: setIframeContent,\n    extend: extend,\n    unique: unique\n}\n\n"]}