{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","js/JSFrameCommunication.js","js/VPAIDHTML5Client.js","js/registry.js","js/utils.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VPAIDHTML5Client.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nvar unique = require('./utils').unique;\nvar SingleValueRegistry = require('./registry').SingleValueRegistry;\nvar MultipleValuesRegistry = require('./registry').MultipleValuesRegistry;\n\n\nfunction JSFrameCommunication(targetFrame, targetOrigin, allowedOrigins, frameID) {\n    this._targetFrame = targetFrame;\n    this._targetOrigin = targetOrigin;\n    this._callbacks = new SingleValueRegistry();\n    this._subscribers = new MultipleValuesRegistry();\n    this._frameID = frameID;\n    this._uniqueCallbackID = unique(frameID);\n    _addListener(this, allowedOrigins);\n}\n\nJSFrameCommunication.prototype.getID = function getID() {\n    return this._frameID;\n}\n\nJSFrameCommunication.prototype.postMessage = function postMessage(type, typeDetail, msg, callback) {\n    var message = {id: this._frameID, type: type, typeDetail: typeDetail, msg: msg};\n    if (callback) {\n        message.callbackID = this._addCallback(callback);\n    }\n    this._targetFrame.contentWindow.postMessage(JSON.stringify(message), this._targetOrigin);\n}\n\nJSFrameCommunication.prototype.on = function on(eventName, handler) {\n    this._subscribers.add(eventName, handler);\n}\n\nJSFrameCommunication.prototype.off = function off(eventName, handler) {\n    this._subscribers.remove(eventName, handler);\n}\n\nJSFrameCommunication.prototype.offEvent = function off(eventName) {\n    this._subscribers.removeByKey(eventName);\n}\n\nJSFrameCommunication.prototype.offAll = function off() {\n    this._subscribers.removeAll();\n}\n\nJSFrameCommunication.prototype._addCallback = function _addCallback(callback) {\n    var callbackID = this._uniqueCallbackID();\n    this._callbacks.add(callbackID, callback);\n    return callbackID;\n}\n\nJSFrameCommunication.prototype._trigger = function trigger(eventName, err, result) {\n    this._subscribers.get(eventName).forEach(function (callback) {\n        setTimeout(function () {\n            callback(err, result);\n        }, 0);\n    });\n};\n\nJSFrameCommunication.prototype._fireCallback = function trigger(callbackID, err, result) {\n    var callback = this._callbacks.get(callbackID);\n    if (callback) {\n        setTimeout(function () {\n            callback(err, result);\n        }.bind(this), 0);\n    }\n}\n\n\nfunction _addListener(context, allowedOrigins) {\n    window.addEventListener('message', function receiveMessage (e) {\n        if (allowedOrigins.indexOf(e.origin) === -1) { return; }\n        var data = JSON.parse(e.data);\n        if (data.id !== context.getID()) { return; }\n\n        if (data.type === 'event') {\n            context._trigger.apply(context, [data.typeDetail].concat(data.msg));\n        } else if (data.type === 'method') {\n            context._fireCallback.apply(context, [data.callbackID].concat(data.msg));\n        }\n\n    });\n}\n\nmodule.exports = JSFrameCommunication;\n\n","'use strict';\n\nvar utils = require('./utils');\nvar JSFrameCommunication = require('./JSFrameCommunication');\nvar unique = utils.unique('vpaidIframe');\n\nfunction VPAIDHTML5Client(el, url, frameConfig, callback) {\n    var id = unique();\n    this._destroyed = false;\n    this._ready = false;\n    this._el = utils.createIframe(el, url + '?vpaidID=' + id);\n    this._frame = new JSFrameCommunication(this._el, frameConfig.origin, frameConfig.allowed, id);\n    this._frame.on('vpaid_handshake', function (err, result) {\n        if(this.isDestroyed()) {return;}\n\n        this._ready = true;\n\n        if (callback) {\n            callback(err, result);\n        }\n\n        if (this._autoLoad) {\n            var autoLoad = this._autoLoad;\n            delete this._autoLoad;\n            this.loadAdUnit(autoLoad.url, autoLoad.callback);\n        }\n\n    }.bind(this));\n}\n\nVPAIDHTML5Client.prototype.destroy = function destroy() {\n    this._destroyed = true;\n}\n\nVPAIDHTML5Client.prototype.isDestroyed = function isDestroyed() {\n    return this._destroyed;\n}\n\nVPAIDHTML5Client.prototype.isReady = function isDestroyed() {\n    return this._ready;\n}\n\nVPAIDHTML5Client.prototype.loadAdUnit = function loadAdUnit(adURL, callback) {\n    if (this._ready) {\n        this._frame.postMessage('method', 'loadAdUnit', adURL, function (err, msg) {\n            if (!err) {\n                this._adUnit = {};\n            }\n            callback(err, this._adUnit);\n        }.bind(this));\n    } else {\n        this._autoLoad = {url: adURL, callback: callback};\n    }\n}\n\nVPAIDHTML5Client.prototype.unloadAdUnit = function unloadAdUnit() {\n    if (this._autoLoad) { delete this._autoLoad; }\n}\n\nVPAIDHTML5Client.prototype.getID = function () {\n    return this._frame.getID();\n}\n\nmodule.exports = VPAIDHTML5Client;\n\n","'use strict';\n\nfunction Registry() {\n    this._registries = {};\n}\n\nfunction $removeByKey(id) {\n    var old = this._registries[id];\n    delete this._registries[id];\n    return old;\n}\n\nfunction $removeByValueHelper(value, handler) {\n    var keys = this.findByValue(value);\n    return keys.map(handler.bind(this));\n}\n\nRegistry.prototype.add = function() {};\nRegistry.prototype.get = function() {};\nRegistry.prototype.remove = function (key) {};\nRegistry.prototype.findByValue = function () {};\nRegistry.prototype.removeByValue = function (value) {};\n\nRegistry.prototype.filterKeys = function filterKeys(handler) {\n    return Object.keys(this._registries).filter(handler);\n};\n\nRegistry.prototype.removeAll = function removeAll() {\n    var old = this._registries;\n    this._registries = {};\n    return old;\n};\n\nRegistry.prototype.size = function size() {\n    return Object.keys(this._registries).length;\n};\n\n/*\n * MultipleValuesRegistry\n */\nfunction MultipleValuesRegistry() {\n    Registry.call(this);\n}\n\nMultipleValuesRegistry.prototype = Object.create(Registry.prototype);\nMultipleValuesRegistry.prototype.removeByKey = $removeByKey;\n\nMultipleValuesRegistry.prototype.add = function add(id, value) {\n    if (!this._registries[id]) {\n        this._registries[id] = [];\n    }\n    if (this._registries[id].indexOf(value) === -1) {\n        this._registries[id].push(value);\n    }\n};\n\nMultipleValuesRegistry.prototype.get = function get(id) {\n    return this._registries[id] || [];\n};\n\nMultipleValuesRegistry.prototype.findByValue = function findByValue(value) {\n    var registries = this._registries;\n    var keys = Object.keys(registries).filter(function(key) {\n        return registries[key].indexOf(value) !== -1;\n    });\n    return keys;\n};\n\nMultipleValuesRegistry.prototype.remove = function remove(key, value) {\n    if (!this._registries[key]) { return; }\n\n    var index = this._registries[key].indexOf(value);\n\n    if (index < 0) { return; }\n    return this._registries[key].splice(index, 1);\n};\n\nMultipleValuesRegistry.prototype.removeByValue = function removeByValue(value) {\n    $removeByValueHelper.call(this, value, function (key) {\n        this.remove(key, value);\n    });\n};\n\n/*\n * SingleValueRegistry\n */\n\nfunction SingleValueRegistry () {\n    Registry.call(this);\n}\n\nSingleValueRegistry.prototype = Object.create(Registry.prototype);\nSingleValueRegistry.prototype.remove = $removeByKey;\n\nSingleValueRegistry.prototype.add = function add(id, value) {\n    this._registries[id] = value;\n};\n\nSingleValueRegistry.prototype.get = function get(id) {\n    return this._registries[id];\n};\n\nSingleValueRegistry.prototype.findByValue = function findByValue(value) {\n    var registries = this._registries;\n    var keys = Object.keys(registries).filter(function (key) {\n        return registries[key] === value;\n    });\n    return keys;\n};\n\nSingleValueRegistry.prototype.removeByValue = function removeByValue(value) {\n    $removeByValueHelper.call(this, value, function (key) {\n        this.remove(key);\n    });\n};\n\nmodule.exports.MultipleValuesRegistry = MultipleValuesRegistry;\nmodule.exports.SingleValueRegistry = SingleValueRegistry;\n\n","'use strict';\n\nmodule.exports.noop = function noop() {};\n\nmodule.exports.createIframe = function createIframe(parent, url) {\n    var nEl = document.createElement('iframe');\n    nEl.src = url;\n    parent.innerHTML = '';\n    parent.appendChild(nEl);\n    return nEl;\n};\n\nmodule.exports.unique = function unique(prefix) {\n    var count = -1;\n    return function () {\n        return prefix + '_' + (++count);\n    };\n}\n\n"]}