{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","js/JSFrameCommunication.js","js/VPAIDHTML5iFrame.js","js/registry.js","js/utils.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VPAIDHTML5iFrame.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nvar unique = require('./utils').unique;\nvar isTrue = require('./utils').constant(true);\nvar SingleValueRegistry = require('./registry').SingleValueRegistry;\nvar MultipleValuesRegistry = require('./registry').MultipleValuesRegistry;\n\n\nfunction JSFrameCommunication(targetFrame, targetOrigin, allowedOrigins, frameID) {\n    this._targetFrame = targetFrame;\n    this._targetOrigin = targetOrigin;\n    this._callbacks = new SingleValueRegistry();\n    this._subscribers = new MultipleValuesRegistry();\n    this._frameID = frameID;\n    this._uniqueCallbackID = unique(frameID);\n    _addListener(this, allowedOrigins);\n}\n\nJSFrameCommunication.prototype.getID = function getID() {\n    return this._frameID;\n}\n\nJSFrameCommunication.prototype.postMessage = function postMessage(type, typeDetail, msg, callback) {\n    var message = {id: this._frameID, type: type, typeDetail: typeDetail, msg: msg};\n    if (callback) {\n        message.callbackID = this._addCallback(callback);\n    }\n    var win = this._targetFrame.postMessage ? this._targetFrame : this._targetFrame.contentWindow;\n    win.postMessage(JSON.stringify(message), this._targetOrigin);\n}\n\nJSFrameCommunication.prototype.on = function on(eventName, handler) {\n    this._subscribers.add(eventName, handler);\n}\n\nJSFrameCommunication.prototype.off = function off(eventName, handler) {\n    this._subscribers.remove(eventName, handler);\n}\n\nJSFrameCommunication.prototype.offEvent = function off(eventName) {\n    this._subscribers.removeByKey(eventName);\n}\n\nJSFrameCommunication.prototype.offAll = function off() {\n    this._subscribers.removeAll();\n}\n\nJSFrameCommunication.prototype._addCallback = function _addCallback(callback) {\n    var callbackID = this._uniqueCallbackID();\n    this._callbacks.add(callbackID, callback);\n    return callbackID;\n}\n\nJSFrameCommunication.prototype._trigger = function trigger(eventName, err, result) {\n    this._subscribers.get(eventName).forEach(function (callback) {\n        setTimeout(function () {\n            callback(err, result);\n        }, 0);\n    });\n};\n\nJSFrameCommunication.prototype._fireCallback = function trigger(callbackID, err, result) {\n    var callback = this._callbacks.get(callbackID);\n    if (callback) {\n        setTimeout(function () {\n            callback(err, result);\n        }.bind(this), 0);\n    }\n}\n\nJSFrameCommunication.prototype.destroy = function destroy() {\n    this.offAll();\n    this._callbacks.removeAll();\n}\n\nJSFrameCommunication.HAND_SHAKE_EVENT = 'vpaid_handshake';\n\nfunction _addListener(context, allowedOrigins) {\n    var validateOrigin = (function () {\n        return (allowedOrigins.indexOf('*') !== -1) ? isTrue : function (origin) {\n            return allowedOrigins.indexOf(origin) !== -1;\n        }\n    })();\n\n    window.addEventListener('message', function receiveMessage (e) {\n        if (!validateOrigin(e.origin)) { return; }\n\n        var data = JSON.parse(e.data);\n        if (data.id !== context.getID()) { return; }\n\n        if (data.type === 'event') {\n            context._trigger.apply(context, [data.typeDetail].concat(data.msg));\n        } else if (data.type === 'method') {\n            context._fireCallback.apply(context, [data.callbackID].concat(data.msg));\n        }\n\n    });\n}\n\nmodule.exports = JSFrameCommunication;\n\n","'use strict';\n\nvar utils = require('./utils');\nvar JSFrameCommunication = require('./JSFrameCommunication');\n\nfunction VPAIDHTML5iFrame(id, frameConfig) {\n    this._frame = new JSFrameCommunication(parent, frameConfig.origin, frameConfig.allowed, id);\n    this._frame.postMessage('event', JSFrameCommunication.HAND_SHAKE_EVENT, [null, 'sucess']);\n}\n\nmodule.exports = VPAIDHTML5iFrame;\nwindow.VPAIDHTML5iFrame = VPAIDHTML5iFrame;\n\n","'use strict';\n\nfunction Registry() {\n    this._registries = {};\n}\n\nfunction $removeByKey(id) {\n    var old = this._registries[id];\n    delete this._registries[id];\n    return old;\n}\n\nfunction $removeByValueHelper(value, handler) {\n    var keys = this.findByValue(value);\n    return keys.map(handler.bind(this));\n}\n\nRegistry.prototype.add = function() {};\nRegistry.prototype.get = function() {};\nRegistry.prototype.remove = function (key) {};\nRegistry.prototype.findByValue = function () {};\nRegistry.prototype.removeByValue = function (value) {};\n\nRegistry.prototype.filterKeys = function filterKeys(handler) {\n    return Object.keys(this._registries).filter(handler);\n};\n\nRegistry.prototype.removeAll = function removeAll() {\n    var old = this._registries;\n    this._registries = {};\n    return old;\n};\n\nRegistry.prototype.size = function size() {\n    return Object.keys(this._registries).length;\n};\n\n/*\n * MultipleValuesRegistry\n */\nfunction MultipleValuesRegistry() {\n    Registry.call(this);\n}\n\nMultipleValuesRegistry.prototype = Object.create(Registry.prototype);\nMultipleValuesRegistry.prototype.removeByKey = $removeByKey;\n\nMultipleValuesRegistry.prototype.add = function add(id, value) {\n    if (!this._registries[id]) {\n        this._registries[id] = [];\n    }\n    if (this._registries[id].indexOf(value) === -1) {\n        this._registries[id].push(value);\n    }\n};\n\nMultipleValuesRegistry.prototype.get = function get(id) {\n    return this._registries[id] || [];\n};\n\nMultipleValuesRegistry.prototype.findByValue = function findByValue(value) {\n    var registries = this._registries;\n    var keys = Object.keys(registries).filter(function(key) {\n        return registries[key].indexOf(value) !== -1;\n    });\n    return keys;\n};\n\nMultipleValuesRegistry.prototype.remove = function remove(key, value) {\n    if (!this._registries[key]) { return; }\n\n    var index = this._registries[key].indexOf(value);\n\n    if (index < 0) { return; }\n    return this._registries[key].splice(index, 1);\n};\n\nMultipleValuesRegistry.prototype.removeByValue = function removeByValue(value) {\n    $removeByValueHelper.call(this, value, function (key) {\n        this.remove(key, value);\n    });\n};\n\n/*\n * SingleValueRegistry\n */\n\nfunction SingleValueRegistry () {\n    Registry.call(this);\n}\n\nSingleValueRegistry.prototype = Object.create(Registry.prototype);\nSingleValueRegistry.prototype.remove = $removeByKey;\n\nSingleValueRegistry.prototype.add = function add(id, value) {\n    this._registries[id] = value;\n};\n\nSingleValueRegistry.prototype.get = function get(id) {\n    return this._registries[id];\n};\n\nSingleValueRegistry.prototype.findByValue = function findByValue(value) {\n    var registries = this._registries;\n    var keys = Object.keys(registries).filter(function (key) {\n        return registries[key] === value;\n    });\n    return keys;\n};\n\nSingleValueRegistry.prototype.removeByValue = function removeByValue(value) {\n    $removeByValueHelper.call(this, value, function (key) {\n        this.remove(key);\n    });\n};\n\nmodule.exports.MultipleValuesRegistry = MultipleValuesRegistry;\nmodule.exports.SingleValueRegistry = SingleValueRegistry;\n\n","'use strict';\n\nmodule.exports.noop = function noop() {};\n\nmodule.exports.createIframe = function createIframe(parent, url) {\n    var nEl = document.createElement('iframe');\n    nEl.src = url || 'about:blank';\n    nEl.width = 0;\n    nEl.height = 0;\n    parent.innerHTML = '';\n    parent.appendChild(nEl);\n    return nEl;\n};\n\nmodule.exports.simpleTemplate = function simpleTemplate(template, data) {\n    Object.keys(data).forEach(function (key) {\n        template = template.replace(new RegExp('{{' + key + '}}', 'g'), JSON.stringify(data[key]));\n    });\n    return template;\n};\n\nmodule.exports.setIframeContent = function setIframeContent(iframeEl, content) {\n    var iframeDoc = getFrameDocument(iframeEl);\n    if (!iframeDoc) return false;\n\n    iframeDoc.open();\n    iframeDoc.writeln(content);\n    iframeDoc.close();\n\n    return true;\n};\n\nmodule.exports.constant = function(value) {\n    return function () {\n        return value;\n    };\n};\n\nfunction getFrameDocument (ifr) {\n    return  ifr.document            ||\n            ifr.contentDocument     ||\n            ifr.contentWindow && ifr.contentWindow.document;\n};\n\nmodule.exports.unique = function unique(prefix) {\n    var count = -1;\n    return function () {\n        return prefix + '_' + (++count);\n    };\n};\n\n"]}